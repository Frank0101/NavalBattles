(function(){var n=window.navalBattles=window.navalBattles||{};n.HitTargetModel=function(n,t){var i=this;i.ship=n;i.relPos=t;i.isHit=!1;i.getAbsPos=function(){return i.ship.isHorizontal?{posX:i.ship.posX+t,posY:i.ship.posY}:{posX:i.ship.posX,posY:i.ship.posY+t}};i.hit=function(n,t,r,u){var f=i.getAbsPos();f.posX==n&&f.posY==t?(i.isHit=!0,r&&r()):u&&u()}}})(),function(){var n=window.navalBattles=window.navalBattles||{};n.ShipModel=function(t,i,r,u){var f=this,e;for(f.posX=t,f.posY=i,f.size=r,f.isHorizontal=u,f.hitTargets=[],e=0;e<f.size;e++)f.hitTargets.push(new n.HitTargetModel(f,e));f.hitCount=function(){for(var t=0,n=0;n<f.hitTargets.length;n++)f.hitTargets[n].isHit&&t++;return t};f.isHit=function(){return f.hitCount()>0};f.isSunk=function(){return f.hitCount()==f.hitTargets.length};f.hit=function(n,t,i,r){for(var e=!1,u=0;u<f.hitTargets.length;u++)if(f.hitTargets[u].hit(n,t,function(){e=!0}),e){i&&i();return}r&&r()}}}(),function(){var n=window.navalBattles=window.navalBattles||{};n.BoardModel=function(n,t){function r(n){var t=n.hitTargets[0].getAbsPos(),r=n.hitTargets[n.hitTargets.length-1].getAbsPos();return t.posX<0||t.posX>=i.sizeX||t.posY<0||t.posY>=i.sizeY||r.posX<0||r.posX>=i.sizeX||r.posY<0||r.posY>=i.sizeY}function u(n,t){for(var u,r,e,i=0;i<n.hitTargets.length;i++)for(u=n.hitTargets[i],r=0;r<t.hitTargets.length;r++)if(e=t.hitTargets[r],f(u,e))return!0;return!1}function f(n,t){var i=n.getAbsPos(),r=t.getAbsPos();return i.posX==r.posX&&i.posY==r.posY}var i=this;i.sizeX=n;i.sizeY=t;i.ships=[];i.missHits=[];i.placeShip=function(n,t,f){if(r(n)){f&&f();return}for(var e=0;e<i.ships.length;e++)if(u(i.ships[e],n)){f&&f();return}i.ships.push(n);t&&t()};i.isAllSunk=function(){for(var n=0;n<i.ships.length;n++)if(!i.ships[n].isSunk())return!1;return!0};i.hit=function(n,t,r,u){for(var e=!1,f=0;f<i.ships.length;f++)if(i.ships[f].hit(n,t,function(){e=!0}),e){r&&r();return}i.missHits.push({posX:n,posY:t});u&&u()}}}();angular.module("navalBattlesApp",["navalBattlesApp.controllers","navalBattlesApp.services","navalBattlesApp.directives"]);angular.module("navalBattlesApp.controllers",[]);angular.module("navalBattlesApp.services",[]);angular.module("navalBattlesApp.directives",[]);angular.module("navalBattlesApp.controllers").controller("navalBattlesController",["$scope","placingService","aiService",function(n,t,i){var r=window.navalBattles;n.init=function(){n.playerBoard=new r.BoardModel(12,12);t.placeShips(n.playerBoard,[2,2,3,3,4,4,5,6]);n.enemyBoard=new r.BoardModel(12,12);t.placeShips(n.enemyBoard,[2,2,3,3,4,4,5,6]);n.isPlayerTurn=!0};n.$watch("isPlayerTurn",function(t){t||i.hit(n.playerBoard,n.endEnemyTurn)});n.endPlayerTurn=function(){n.isPlayerTurn=!1};n.endEnemyTurn=function(){n.isPlayerTurn=!0};n.playerWins=function(){return n.enemyBoard.isAllSunk()};n.enemyWins=function(){return n.playerBoard.isAllSunk()};n.isEndGame=function(){return n.playerWins()||n.enemyWins()};n.init()}]);angular.module("navalBattlesApp.services").service("placingService",[function(){var n=window.navalBattles,t=this;t.placeShips=function(t,i){for(var u,f,e,o,s,h,r=0;r<i.length;r++)for(u=i[r],f=!1;f==!1;)e=Math.floor(Math.random()*2)==0,e?(o=Math.floor(Math.random()*(t.sizeX-u+1)),s=Math.floor(Math.random()*t.sizeY)):(o=Math.floor(Math.random()*t.sizeX),s=Math.floor(Math.random()*(t.sizeY-u+1))),h=new n.ShipModel(o,s,u,e),t.placeShip(h,function(){f=!0},function(){f=!1})}}]);angular.module("navalBattlesApp.services").service("aiService",[function(){function u(n){for(var e,t,i,r,o,u=[],f=0;f<n.ships.length;f++)for(e=n.ships[f],t=0;t<e.hitTargets.length;t++)i=e.hitTargets[t],i.isHit&&u.push({posX:i.getAbsPos().posX,posY:i.getAbsPos().posY,isHit:!0});for(r=0;r<n.missHits.length;r++)o=n.missHits[r],u.push({posX:o.posX,posY:o.posY,isHit:!1});return u}function f(r,u,f){for(var e,o=[],a=0;a<r.length;a++)if(e=r[a],e.isHit){var s=e.posY>0?n(r,e.posX,e.posY-1):null,h=e.posY<f-1?n(r,e.posX,e.posY+1):null,c=e.posX>0?n(r,e.posX-1,e.posY):null,l=e.posX<u-1?n(r,e.posX+1,e.posY):null;e.posY>0&&s==null&&(t(c,l)||i(h))&&o.push({posX:e.posX,posY:e.posY-1});e.posY<f-1&&h==null&&(t(c,l)||i(s))&&o.push({posX:e.posX,posY:e.posY+1});e.posX>0&&c==null&&(t(s,h)||i(l))&&o.push({posX:e.posX-1,posY:e.posY});e.posX<u-1&&l==null&&(t(s,h)||i(c))&&o.push({posX:e.posX+1,posY:e.posY})}return o}function n(n,t,i){for(var u,r=0;r<n.length;r++)if(u=n[r],u.posX==t&&u.posY==i)return u;return null}function t(n,t){return(n==null||!n.isHit)&&(t==null||!t.isHit)}function i(n){return n!=null&&n.isHit}var r=this;r.hit=function(t,i){var h=u(t),o=f(h,t.sizeX,t.sizeY),r,e,c,s;if(o.length>0)c=Math.floor(Math.random()*o.length),s=o[c],r=s.posX,e=s.posY;else do r=Math.floor(Math.random()*t.sizeX),e=Math.floor(Math.random()*t.sizeY);while(n(h,r,e)!=null);t.hit(r,e);i&&i()}}]);angular.module("navalBattlesApp.directives").directive("boardDirective",function(){return{restrict:"E",replace:!0,scope:{board:"=",showShips:"="},templateUrl:"/NavalBattlesApp/App/Views/boardDirective.html",controller:["$scope",function(n){n.range=function(n){for(var i=new Array(n),t=0;t<i.length;t++)i[t]=t;return i}}]}});angular.module("navalBattlesApp.directives").directive("hitGridDirective",function(){return{restrict:"E",replace:!0,scope:{board:"=",onCellSelect:"&"},templateUrl:"/NavalBattlesApp/App/Views/hitGridDirective.html",controller:["$scope",function(n){n.range=function(n){for(var i=new Array(n),t=0;t<i.length;t++)i[t]=t;return i};n.selectCell=function(t,i){n.board.hit(i,t);n.onCellSelect&&n.onCellSelect()}}]}});
//# sourceMappingURL=navalBattles.min.js.map
